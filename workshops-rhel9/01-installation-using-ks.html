<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: RHEL 9 Workshops</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/course-template/workshops-rhel9/01-installation-using-ks.html">
    <link rel="prev" href="01-installation-repositories.html">
    <link rel="next" href="01-installation-resources.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-scholars.github.io/course-template">RHEL 9 Workshops</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="workshops-rhel9" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="00-README.html">0. README</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-installation.html">1. Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-installation-kickstart.html">1.1 Kickstart files</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-installation-repositories.html">1.2 Network repositories</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="01-installation-using-ks.html">1.3 Using Kickstart files</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-installation-resources.html">A.1 RHEL 9 Installation Resources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-management.html">2. RHEL Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-management-install.html">2.1 Installing Cockpit</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-management-resources.html">A.1 Cockpit Resources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-containers.html">3. Deploying Containers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-containers-rpms.html">3.1 Installing container tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-containers-serverless.html">3.2 Deploying Serverless Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-containers-podman-autoupdate.html">3.3 Podman auto-update</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-containers-podman-rollback.html">3.4 Performing automatic rollbacks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-containers-resources.html">A.1 Container Resources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-builder.html">4. Image Builder</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-builder-installing.html">4.1 Installing Image Builder</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-builder-blueprints.html">4.2 Blueprints</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-builder-cmdline.html">4.3 Using image builder from the command line</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-builder-resources.html">A.1 Image Builder Resources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-security.html">5. Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-security-session-recording.html">5.1 Session Recording</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-security-resources.html">A.1 Security Resources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-edge.html">6. Edge Computing with RHEL</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-edge-deployment.html">6.1 Deployment for RHEL in the Edge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-edge-builder.html">6.2 Deployment for RHEL in the Edge using Image Builder</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-edge-insights.html">6.3 Deployment for RHEL in the Edge using Red Hat Insights</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-edge-resources.html">A.1 Edge Resources</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">RHEL 9 Workshops</a></li>
    <li><a href="01-installation.html">1. Installation</a></li>
    <li><a href="01-installation-using-ks.html">1.3 Using Kickstart files</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/jadebustos/workshops-rhel9/edit/master/documentation/modules/ROOT/pages/01-installation-using-ks.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="usingkickstartfiles"><a class="anchor" href="#usingkickstartfiles"></a>Using kickstart files from an Apache Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To perform an unattended deployment we can boot from a RHEL iso, edit the boot commands and add the following <strong>inst.ks=http://httpd-server/ks/custom-kickstart.ks</strong>.</p>
</div>
<div class="paragraph">
<p>This will perform the installation according to the kickstart file included in the boot command line.</p>
</div>
<div class="paragraph">
<p>To perform an unattended deployment:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a Virtual Machine with at least 15 GB disk, 2 CPU and 4 GB of RAM.</p>
</li>
<li>
<p>Use the RHEL 9 Installation DVD to boot the Virtual Machine (rhel-baseos-9.0-x86_64-dvd.iso) as you will do to perform a manual installation.</p>
</li>
<li>
<p>At the boot menu select the <strong>Install Red Hat Enterprise Linux 9.0</strong> and press the <strong>Tab</strong> key to edit the boot options:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kickstart/rhel9-boot-menu.png" alt="rhel9 boot menu">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add <strong>inst.ks=http://192.168.122.1/ks/anaconda-ks.cfg</strong> and press return to start the unattended deployment.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kickstart/boot-network-kickstart.png" alt="boot network kickstart">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Replace the kickstart URL for your kickstart file URL.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The kickstart used in this example is <a href="https://raw.githubusercontent.com/jadebustos/workshops-rhel9/master/documentation/modules/ROOT/assets/files/kickstart/anaconda-ks.cfg">this one</a>. After finishing the deployment you will have to reboot the server manually.</p>
</div>
<div class="paragraph">
<p>You must take into consideration:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This is a simple kickstart example.</p>
</li>
<li>
<p>IP configuration is done using DHCP.</p>
</li>
<li>
<p>Root user can not be accessed by SSH (password is in kickstart comments).</p>
</li>
<li>
<p>The install DVD must be used due to there are no network repositories configured.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As kickstart files is not one of these workshops purposes so if you are not comfortable with kickstart files you should modify the above kickstart file to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create non-root users.</p>
</li>
<li>
<p>Provide passwordless sudo to some users.</p>
</li>
<li>
<p>Install additional software.</p>
</li>
<li>
<p>Perform custom disk partitioning.</p>
</li>
<li>
<p>Configure static network configuration.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_kickstart_files_from_within_a_dvd_iso"><a class="anchor" href="#_using_kickstart_files_from_within_a_dvd_iso"></a>Using kickstart files from within a DVD ISO</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The above method is not a completely unattended method due to you will have to manually add the URL for the kickstart file.</p>
</div>
<div class="paragraph">
<p>To perform a completely unattended deployment we need:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A RHEL/Fedora machine (or a Linux one).</p>
</li>
<li>
<p>The RHEL 9 Install DVD in the machine (<strong>/root/rhel-baseos-9.0-x86_64-dvd.iso</strong>).</p>
</li>
<li>
<p>A customized kickstart file (<strong>/root/custom-ks.cfg</strong>).</p>
</li>
<li>
<p>To modify the RHEL 9 Installation DVD to include the kickstart url.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>So we need to have free disk space to store:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The RHEL 9 Install DVD.</p>
</li>
<li>
<p>A copy for the RHEL 9 Install DVD.</p>
</li>
<li>
<p>The customized RHEL 9 Installation DVD.</p>
</li>
<li>
<p>If you plan to add additional RPM packages you must have free disk for them.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So at least we need 3 times free space for the RHEL 9 Install DVD.</p>
</div>
<div class="paragraph">
<p>We have mount the RHEL 9 Installation DVD and copy all the contents to a temporary directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@rhel9 ~]# mkdir /media/isos
[root@rhel9 ~]# mount -t iso9660 /root/rhel-baseos-9.0-x86_64-dvd.iso /media/isos -o loop
[root@rhel9 ~]# mkdir /tmp/customiso
[root@rhel9 ~]# cp -prf /media/isos/* /tmp/customiso
[root@rhel9 ~]#</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We will do all the customization under the <strong>/tmp/customiso</strong> directory.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We will need to allow writing in some files/directories:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@rhel9 ~]# chmod 0755 /tmp/customiso/{images,BaseOS,AppStream,AppStream/repodata,AppStream/Packages,BaseOS/
repodata,BaseOS/Packages,EFI,EFI/BOOT}
[root@rhel9 ~]# chmod 0644 /tmp/customiso/isolinux/isolinux.bin
[root@rhel9 ~]#</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we need to install some utilities to be able to create the customized DVD boot image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@rhel9 ~]# dnf install genisoimage syslinux squashfs-tools createrepo -y
[root@rhel9 ~]#</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s get the RHEL 9 Install DVD label:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@rhel9 ~]# ISOLABEL=$(isoinfo -d -i /root/rhel-baseos-9.0-x86_64-dvd.iso | \
    grep 'Volume id:' | awk -F' ' '{print $3}')
[root@rhel9 ~]# echo $ISOLABEL
RHEL-9-0-0-BaseOS-x86_64
[root@rhel9 ~]#</code></pre>
</div>
</div>
<div class="paragraph">
<p>We need to copy the kickstart file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@rhel9 ~]# cp /root/custom-ks.cfg /tmp/customiso
[root@rhel9 ~]#</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@rhel9 ~]# mount /tmp/customiso/images/efiboot.img /mnt/ -o loop
[root@rhel9 ~]#</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are going to edit the boot menu to add the kickstart part so no user action will be required to perform the installation. So we have to edit the file <strong>/mnt/EFI/BOOT/grub.cfg</strong> and add the <strong>inst.ks</strong> part:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">menuentry 'Install Red Hat Enterprise Linux 9.0' --class fedora --class gnu-linux --class gnu --class os {
        linuxefi /images/pxeboot/vmlinuz inst.stage2=hd:LABEL=RHEL-9-0-0-BaseOS-x86_64 inst.ks=hd:LABEL=RHEL-9-0-0-BaseOS-x86_64:/custom-ks.cfg quiet
        initrdefi /images/pxeboot/initrd.img
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
We can get the DVD label from that file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After the modifications we umount the <strong>efiboot.img</strong>. We perform changes we have just made in <strong>/mnt/EFI/BOOT/grub.cfg</strong> in the file <strong>/tmp/customiso/EFI/BOOT/grub.cfg</strong></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
We can add/remove packages to the <strong>BaseOS</strong> and <strong>AppStream</strong> repositories. If we decided to we will need to recreate the repository data using the <strong>createrepo</strong> command. Remember to use the comps-XXX.xml file to recreate the repository data and to modify it if you want to add additional install groups.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s modify <strong>/tmp/customiso/isolinux/isolinux.cfg</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">...
label linux
  menu label ^Install Red Hat Enterprise Linux 9.0
  kernel vmlinuz
  append initrd=initrd.img inst.stage2=hd:LABEL=RHEL-9-0-0-BaseOS-x86_64 inst.ks=hd:LABEL=RHEL-9-0-0-BaseOS-x86_64:/custom-ks.cfg quiet
...
label text
  menu indent count 5
  menu label Install Red Hat Enterprise Linux 9.0 using ^text mode
  text help
        Try this option out if you're having trouble installing
        Red Hat Enterprise Linux 9.0.
  endtext
  kernel vmlinuz
  append initrd=initrd.img inst.stage2=hd:LABEL=RHEL-9-0-0-BaseOS-x86_64 inst.text inst.ks=hd:LABEL=RHEL-9-0-0-BaseOS-x86_64:/custom-ks.cfg quiet
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can create our custom ISO:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@rhel9 customiso]# mkisofs -o /root/custom-rhel-baseos-9.0-x86_64-dvd.iso \
    -b isolinux/isolinux.bin -J -R -l -c isolinux/boot.cat -no-emul-boot \
    -boot-load-size 4 -boot-info-table -eltorito-alt-boot -e images/efiboot.img \
    -no-emul-boot -graft-points -joliet-long -V $ISOLABEL .
[root@rhel9 customiso]# isohybrid --uefi /root/custom-rhel-baseos-9.0-x86_64-dvd.iso
isohybrid: Warning: more than 1024 cylinders: 8182
isohybrid: Not all BIOSes will be able to boot this device
[root@rhel9 customiso]#</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It seems that there is <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1914955">a regression in RHEL 9.0</a> so this will not work, yet.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now you can use the custom ISO to boot and install a RHEL 9 using the embedded kickstart or a kickstart in an Apache server if you prefer.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="01-installation-repositories.html">1.2 Network repositories</a></span>
  <span class="next"><a href="01-installation-resources.html">A.1 RHEL 9 Installation Resources</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
